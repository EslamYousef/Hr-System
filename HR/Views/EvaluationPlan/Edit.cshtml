@model HR.Models.EvaluationPlan
@using HR.Resource;
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/MainLayOut.cshtml";
}
@Scripts.Render("~/bundles/jqueryval")
<div class="content-wrapper">

    <section class="content-header">
        <h1>
            @pers_2.evaluationplan
        </h1>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="box">
            <!-- /.box-header -->
            <div class="box-body">
                @using (Html.BeginForm("Edit", "EvaluationPlan", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    <div class="form-horizontal">
                        <hr />
                        @if (TempData["Message"] != null)
                        {
                            <div class="alert alert-danger alert-dismissible" role="alert">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                @TempData["Message"]
                            </div>
                        }
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                        <div class="form-group">
                            <input name="id"  id="ID_of_plan" value="@Model.ID" hidden/>
                            <label class="control-label col-md-2" style="color:orangered">
                                @Basic.code
                            </label>

                            <div class="col-md-4">
                                @Html.EditorFor(model => model.Code, new { htmlAttributes = new { id = "code_plan", @readonly = true, @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Code, "", new { @class = "text-danger" })
                            </div>
                            <label class="control-label col-md-2">
                                @Basic.description
                            </label>
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                            </div>


                        </div>
                        <div class="form-group">

                            <label class="control-label col-md-2" style="color:orangered">
                                @Basic.name
                            </label>
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
                            </div>
                            <label class="control-label col-md-2">
                                @pers_2.Previousappraisaltoreview
                            </label>
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.previous_apprisal_to_review, new { htmlAttributes = new { @type = "number", @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-2" style="color:orangered">
                                @pers_2.years
                            </label>
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.Year, new { htmlAttributes = new { id = "year_plan", @type = "number", @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                            </div>
                            <label class="control-label col-md-2">

                            </label>
                            <div class="col-md-2">
                                <a href="@Url.Action("index","EvaluationPlan")" style="width:100%" class="btn btn-danger btn-sm"><i class="fa fa-trash-o"></i>@pers_2.selectemployee</a>
                            </div>
                            <div class="col-md-2">
                                <a href="@Url.Action("index","EvaluationPlan")" style="width:100%" class="btn btn-danger btn-sm"><i class="fa fa-trash-o"></i>@pers_2.showemployee</a>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-2" style="color:orangered">
                                @pers_2.Appraisaltype
                            </label>
                            <div class="col-md-4">
                                @Html.DropDownListFor(model => model.EvaluationTypeID, new SelectList(ViewBag.type, "ID", "Code"), pers_2.Evaluationtype, new { @onclick = "addrow()", @name = "type", @class = "select2", @id = "Country" })
                            </div>
                            <label class="control-label col-md-2">

                            </label>


                            <div class="col-md-2">
                                <button style="width:100%" type="submit" id="btnSave" class="btn btn-success" name="Command" value="Save">@organ.edit</button>
                            </div>

                            <div class="col-md-2">

                                <a href="@Url.Action("index","EvaluationPlan")" style="width:100%" class="btn btn-danger btn-sm"><i class="fa fa-trash-o"></i>@Basic.Back</a>


                            </div>
                        </div>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>
                                        <label class="control-label col-md-3">@pers_2.code </label>
                                    </th>
                                    <th>
                                        <label class="control-label col-md-3">@pers_2.periodstart </label>
                                    </th>
                                    <th>
                                        <label class="control-label col-md-3">@pers_2.periodend</label>
                                    </th>
                                    <th>
                                        <label class="control-label col-md-3">@pers_2.processstart </label>
                                    </th>
                                    <th>
                                        <label class="control-label col-md-3">@pers_2.processend</label>
                                    </th>

                                </tr>
                            </thead>
                            <tbody id="uad8d2">
                               
                                
                            </tbody>
                        </table>

                    </div>
                }

            </div>

        </div>

    </section>
</div>
@section scripts{}
<script>

    $(function () {
        addrow2();
    });

        function addrow() {
            debugger
            var id = $("#Country").val();
            var code = $("#code_plan").val();
            var year = $("#year_plan").val();
            if (year==""|| id == "0" || id == "" || id == null) {
                debugger
                alter("you must choose Appraisal type")
            }
            else {
                $.ajax({
                    type: "post",
                    url: "/EvaluationPlan/FindType",
                    async: false,
                    data: { "id": id, "year": year,"code":code },
                    success: function (result) {
                        debugger
                        $("#uad8d2").empty();
                        $.each(result, function (key, value) {
                            debugger
                            var valx = new Date(value.period_start);
                            var month;
                            if ((valx.getMonth() + 1) < 10) {
                                month = "0" + (valx.getMonth() + 1).toString();
                            }
                            else {
                                month = valx.getMonth() + 1;
                            }
                            var day = parseInt(valx.getDate());
                            if (day < 10) {
                                day = "0" + (valx.getDate()).toString();
                            }
                            else {
                                day = valx.getDate();
                            }
                            var d = valx.getFullYear() + '-' + month + '-' + day;



                            var valx = new Date(value.period_End);
                            var month;
                            if ((valx.getMonth() + 1) < 10) {
                                month = "0" + (valx.getMonth() + 1).toString();
                            }
                            else {
                                month = valx.getMonth() + 1;
                            }
                            var day = parseInt(valx.getDate());
                            if (day < 10) {
                                day = "0" + (valx.getDate()).toString();
                            }
                            else {
                                day = valx.getDate();
                            }
                            var dd = valx.getFullYear() + '-' + month + '-' + day;
                            var t =
                          "<tr><td class='col-md-1'><input class = 'form-control'   type='text' readonly style='margin-bottom: 1em;margin-left:4px' name='ID_sch'   value='" + value.code + "' readonly='readonly' />" + "</td>" +
                          "<td class='col-md-3'> " + "<input class = 'form-control'  required  style='margin-bottom: 1em;margin-left:4px' name='period_start' type='date'  value='" + d + "'  />" + "</td>" +
                          "<td class='col-md-3'> " + "<input class = 'form-control'   required style='margin-bottom: 1em;margin-left:4px' name='period_End' type='date'  value='" + dd + "'  />" + "</td>" +
                         "<td class='col-md-3'> " + "<input class = 'form-control'   required  style='margin-bottom: 1em;margin-left:4px' name='Process_Start' type='date'  value='" + d + "'  />" + "</td>" +
                         "<td class='col-md-3'> " + "<input class = 'form-control'   required  style='margin-bottom: 1em;margin-left:4px' name='process_end' type='date'  value='" + dd + "' />" + "</td></tr>"

                            $("#uad8d2").append(t);

                        });
                    },
                    error: function () {
                        debugger
                        alter("some error");
                    }

                });

            }
        }
        function addrow2() {
            debugger
            var id = $("#ID_of_plan").val();
            if ( id == "0" || id == "" || id == null) {
                debugger
                alter("you must choose Appraisal type")
            }
            else {
                $.ajax({
                    type: "post",
                    url: "/EvaluationPlan/FindType2",
                    async: false,
                    data: { "id": id },
                    success: function (result) {
                        debugger
                        $("#uad8d2").empty();
                        $.each(result, function (key, value) {
                            debugger
                            var d1 = converttodate(value.period_start)
                            var d2 = converttodate(value.period_End)
                            var d3 = converttodate(value.process_start)
                            var d4 = converttodate(value.process_end)
                           
                            var t =
                          "<tr><td class='col-md-1'><input class = 'form-control'   type='text' readonly style='margin-bottom: 1em;margin-left:4px' name='ID_sch'   value='" + value.code + "' readonly='readonly' />" + "</td>" +
                          "<td class='col-md-3'> " + "<input class = 'form-control'  required  style='margin-bottom: 1em;margin-left:4px' name='period_start' type='date'  value='" + d1 + "'  />" + "</td>" +
                          "<td class='col-md-3'> " + "<input class = 'form-control'   required style='margin-bottom: 1em;margin-left:4px' name='period_End' type='date'  value='" + d2 + "'  />" + "</td>" +
                         "<td class='col-md-3'> " + "<input class = 'form-control'   required  style='margin-bottom: 1em;margin-left:4px' name='Process_Start' type='date'  value='" + d3 + "'  />" + "</td>" +
                         "<td class='col-md-3'> " + "<input class = 'form-control'   required  style='margin-bottom: 1em;margin-left:4px' name='process_end' type='date'  value='" + d4 + "' />" + "</td></tr>"

                            $("#uad8d2").append(t);

                        });
                    },
                    error: function () {
                        debugger
                        alter("some error");
                    }

                });

            }
        }


        function converttodate(value)
        {
            var valx = new Date(value);
            var month;
            if ((valx.getMonth() + 1) < 10) {
                month = "0" + (valx.getMonth() + 1).toString();
            }
            else {
                month = valx.getMonth() + 1;
            }
            var day = parseInt(valx.getDate());
            if (day < 10) {
                day = "0" + (valx.getDate()).toString();
            }
            else {
                day = valx.getDate();
            }
            var d = valx.getFullYear() + '-' + month + '-' + day;
            return d;
        }
</script>